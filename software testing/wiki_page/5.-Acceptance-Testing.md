## Plan 
***

The tasks for the Acceptance Testing were divided by the following way 
| Tasks                         	| Assignee                        	|
|-------------------------------	|---------------------------------	|
| Feature 1: Add Visit          	| Catherine Van Gheluwe           	|
| Feature 2: Add User           	| Catherine Van Gheluwe           	|
| Feature 3: Filter for User    	| Ping Gu                         	|
| Documentation: Testing Plan   	| Ping Gu & Catherine Van Gheluwe 	|
| Documentation: Testing Report 	| Ping Gu & Catherine Van Gheluwe 	|
### <u> Testing Strategy </u>

Black box testing techniques will be the preferred method to verify that the PetClinic Application will comply with the expected behavior of the system. Black box testing is more appropriate than white box testing at the system's level of testing as it helps categorize all the inputs and then derive the expected outputs. Hence, optimizing the chances of determining all possible scenarios of a feature. Within the black box testing techniques, to derive all our test cases for our three selected features, **_scenario graphs_** were used. To begin, an initial scenario graph was developed which described the main scenario. Once the initial scenario graph was complete, for each node of the graph, an alternative path would be developed, if needed. Adding these alternatives paths, will allow us to generate all the test cases that might be implemented in the project. In order to evaluate the PetClinic’s behavior as a software system, our goal is to implement all generated test cases/scenarios. 

For the purposes of the project, only the three features of the PetClinic Application will be undergoing Acceptance Tests. The following three features were selected based on their code complexity and how frequent these features may be called upon when a user is using the PetClinic Application. 


#### <u> **Feature 1: Add a new owner** </u>
* <u>User Story:</u> As a user of the PetClinic Application, I would like to add a new owner, so that this particular owner can book appointments for their pets. 
* <u> Actors:</u> User of the PetClinic Application 
* <u> Preconditions:</u> The user already has the information about the new owner and the user is on the webpage that displays the add new user form 
* <u> Justification for Selection:</u>  Selected based on how frequent and critical this feature is used while running the Pet Application. Ensuring this feature works allows more users to be able to join and connect with veterinarians. 

Scenario:
1. User must specify all the required fields ( first name, last name , city, address, telephone).
2. Once completed, user must submit the form
3. The system will display a webpage with the new owner's information.

Alternative scenarios
 - 1a. User specifies all the required but forgets to specify first name field
 - 1a1. Once completed, user must submit the form
 - 1a2.The system will redisplay the form with an error messages under first name field. 
 - 1b. User specifies all the required but forgets to specify to specify last name field
 - 1b1. Once completed, user must submit the form
 - 1b2. The system will redisplay the form with an error messages "must not be empty" under last name field. 
 - 1c. User specifies all the required but forgets to specify  to specify city field
 - 1c1. Once completed, user must submit the form
 - 1c2. The system will redisplay the form with an error message "must not be empty" under city field.
 - 1d. User specifies all the required but forgets to specify  telephone field.
 - 1d1. Once completed, user must submit the form
 - 1d2. The system will redisplay the form with an error message "must not be empty. numeric values out of bounds" under telephone field
 - 1e. User species all the required fields but forgets to specify city name field. 
 - 1e1. User submits form 
 - 1e2. he system will redisplay the form with an error message "must not be empty" under telephone field

Post conditions (for main): the new owner is added in the database. 

Post conditions (for alternative scenario 1a,1b,1c,1d): the new owner is not added in the database.

 
**<u> Feature 2: Create new visit for owner's pet:</u>**
* <u>User Story:</u> As a user of the PetClinic Application, I would like to create a new appointment for an owner's pet, so that this particular pet can be treated by a veterinarian.
* <u> Actors:</u> User
* <u> Preconditions: </u> There is an owner with a pet that already exists in a database 
* <u> Justification of selection: </u> This feature was selected due to the complexity of of the code. In fact, when testing "create a visit", the tests must verify the validity of endpoints for three objects ( owner, pet & visit)while ensuring that the association between these objects are done correctly and the appropriate information is displayed on the UI. 

Scenario: 
1. User must complete all required fields ( date and description)
2. The User must click on “add a visit”.  (omitted, do a call to API using functions)
3. The system will display the created visited at the top of the list 

Alternative Scenarios
  - 1a. Only date is missing ( Alternative)
  - 1a1. User submits the form
  - 1a2. The system will add the visit object to the database
  - 1b.  Only description is missing (Alternative)
  - 1b1. User submits the form
  - 1b2.  the system will not add the visit object to the database
  - 1b3. the system will redisplay the form page
  - 1b4. an error message under the description field will be displayed.
  - 1C. Date and Description are missing
  - 1c1. User submits the form
  - 1c2. the visit should not be added to the database
  - 1c3. The system will redisplay the form page
  - 1c4. An error message under the description field will be displayed.
  - 1D. Date not well formatted 
  - 1d1.  User submits the form
  - 1d2. the visit should not be added to the database
  - 1d3. the system will redisplay the form page
  - 1E. Date not well formatted and description missing 
  - 1e1. User submits the form
  - 1e2. the visit should not be added to the database
  - 1e3. the system will redisplay the form page

**<u> Feature 3: Filter through owner:</u>** As a user of the PetClinic Application, I would like to find owners by their last name, so that I can access the sepcified owners’ information. 
* <u> Actors:</u> User of the PetClinic Application 
* <u> Preconditions:</u> The user is on the webpage of the PetClinic Application and has the last name of the owner he would like to obtain information about.
* <u> Justification for Selection:</u>  Selected based on how frequent and critical this feature is used while running the Pet Application. Ensuring this feature works users to use the application more efficiently when they want to obtain or modify information about a certain owner and when there are mutliple owners registered in the application.

Scenario:
1. User input the last name of the user he wants to find
2. User asks the system to return the owner with the specified last name.
3. The system find the owner with the specified last name.
4. The system returns the webpage displaying the information of the specified owner. 

Alternative Scenarios
* 1a: User does not specify any last name.
* 1a1: System returns a list containing all existing owner at step 4.
* 3a: System cannot find an owner with specified last name.
* 3a1: System returns an error.
* 3b: System finds multiple owner with the specified last name.
* 3b1: System returns a webpage containing all owner with specified last name at step 4.


## Report 

***

In order to properly develop our acceptance test cases, new software technologies and their Maven dependencies were added to the project. Hence, the [pom.xml](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/acceptance-testing/pom.xml) file has been modified. The new dependencies are listed here: 
 * `cucumber-spring` to allow us to use Cucumber annotations 
 * `cucumber-java` to allow us to use cucumber-java
 * `cucumber-junit` dependency

In addition, instead of using Java Spring Boot's mockMvc, Spring Boot Web Clients [Test Rest Template](https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/web/client/TestRestTemplate.html) was used to invoke the PetClinic's end points. Unlike unit, integration and API testing, since the implementation of step definitions & cucumber annotations were mandatory to run our test cases, mockMvc and Mockito were not software tools that worked for Acceptance testing. Hence, the reason why we choose to use Spring Boot's Test Rest Template. Finally, a custom made Java class [CucumberConfiguration](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/acceptance-testing/src/test/java/Acceptance/cucumber/CucumberConfiguration.java) to facilitate the conversation of Cucumber Datatables into objects from the PetClinic models. 

### Feature 1: Add a new owner user
#### Java Mappings
The feature file for "Add a new owner user" is located under [src/test/java/Acceptance/features/AddUser.feature](
https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/features/AddUser.feature
)
The step definitions for Add a new owner is located under [src/test/java/Acceptance/cucumber/stepdefs/AddUser.java](
https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/cucumber/stepdefs/AddUser.java
)
* `@Before public void setUp(){}`: This occurs at the beginning of each scenario. Since we will store the data from the database in two variables  _private List<Owner> expectedOwners;_ and _private List<Owner> actualOwners_, we must intiailize them as empty ArrayLists. Then, we using TestRestTemplate and JSoup, we will populate the _ expectedOwner_ and _actualOwners_ list with the already existing owners of the PetClinic Application.
* `@Given("the following information for an owner")`: With all the necessary attributes provided as the input, the CucumberConfiguration transformer method will be able to create an owner object. The create owner object will be stored in the global variable _Owner ownerToBeAdded_ and added to the _List<Owner> expectedOwner_.
* `@When("the user requests to add a new owner")`: Occurs when the user has finished completing the fields of the create/update form. This function will call the POST operation on the correct input to create the new owner object which is stored in the global variable _Owner ownerToBeAdded _. 
* `@Then("the new owner should be added")`: Once the POST operation returns, then _ownerToBeAdded_ should be added in the database. In this method, we use the_ OwnerRepository class _to find an owner with the corresponding ID and added to the _List<Owner> actualOwners._ Since the _List<Owner> actualOwners_ and the _List<Owner> expectedOwners_ are arraylists and elements added to arraylists are added at the end. Hence, to make sure that the POST endpoint operated as expected, the last element of the _List<Owner> actualOwners_ and the _List<Owner> expectedOwners_ will be compared.
* `@Then("the new owner should not be added")`: Occurs when there was some kind of error when filling out the form. Therefore, we validate that when we search for an owner with the ID( provided in the Given function) should return null.
* `@And("an error message should be displayed under the first name field")`: Jsoup is used to get the HTML element that contains the error message under the first name field. Once we find this element, Assertion is expected to return true since it is expected that the text in the HTML first name error element has the expected error message.
* `@And("an error message should be displayed under the last name field")`: Jsoup is used to get the HTML element that contains the error message under the  last name field. Once we find this element, Assertion is expected to return true since it is expected that the text in the HTML last name error element has the expected error message.
* `@And("an error message should be displayed under the city field")`: Jsoup is used to get the HTML element that contains the error message under the  city field. Once we find this element, Assertion is expected to return true since it is expected that the text in the HTML city error element has the expected error message.
* `@And("^an error message should be displayed under the address field$")`Jsoup is used to get the HTML element that contains the error message under the  address field. Once we find this element, Assertion is expected to return true since it is expected that the text in the HTML address error element has the expected error message.
* `@And("an error message should be displayed under the telephone field")`: Jsoup is used to get the HTML element that contains the error message under the  address field. Once we find this element, Assertion is expected to return true since it is expected that the text in the HTML telephone  error element has the expected error message.

#### Documentation for each scenario:
| Name                                              	| Events     	| Gherklin <br>Scenario <br>File                                                                                                                          	| Set up steps                      	| Tear down <br>Steps 	| Inputs                                                                                                             	| Outputs                                                	| Results 	|
|---------------------------------------------------	|------------	|---------------------------------------------------------------------------------------------------------------------------------------------------------	|-----------------------------------	|---------------------	|--------------------------------------------------------------------------------------------------------------------	|--------------------------------------------------------	|---------	|
| Add a new owner                                   	| 1-2-3      	| [AddUser.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/features/AddUser.feature) 	| @Before <br>public void setUp(){} 	| none                	| `firstName: , lastName: Daniels, id: 15,<br> address: 123 McGill Avenue, city: Montreal,<br>telephone: 5148970943` 	| java.lang.AssertionError:expected:<[Owner@3b0471a5 id = 11, new = false, lastName = 'Morgan', firstName = 'Captain', address = '123 McGill Avenue', city = 'Montreal', telephone = '5148970943']> but was null        	| Fail    	|
| Add a new owner with missing <br>first name field 	| 1a-1a1-1a2 	| [AddUser.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/features/AddUser.feature) 	| @Before <br>public void setUp(){} 	| none                	| `firstName: Jack , lastName: , id: 15, <br>address: 123 McGill Avenue, city: Montreal,<br>telephone: 5148970943`   	| owner is not added, <br>error message is<br>displayed  	| Pass    	|
| Add a new owner with missing<br>last name field   	| 1b-1b1-1b2 	| [AddUser.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/features/AddUser.feature) 	| @Before <br>public void setUp(){} 	| none                	| `firstName: Jack , lastName: , id: 15, <br>address: 123 McGill Avenue, city: Montreal,<br>telephone: 5148970943`   	| owner is not added, <br>error message is <br>displayed 	| Pass    	|
| Add a new owner with missing <br>city field       	| 1c-1c1-1c2 	| [AddUser.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/features/AddUser.feature) 	| @Before <br>public void setUp(){} 	| none                	| `firstName:Jack , lastName: Daniels, id: 15,<br> address: 123 McGill Avenue, city:,<br>telephone: 5148970943`      	| owner is not added, e<br>rror message is <br>displayed 	| Pass    	|
| Add a new owner with missing <br>telephone field  	| 1d-1d1-1d2 	| [AddUser.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/features/AddUser.feature) 	| @Before <br>public void setUp(){} 	| none                	| `firstName: Jack , lastName: Daniels, id: 15, <br>address: 123 McGill Avenue, city: Montreal,<br>telephone: `      	| owner is not added, <br>error message is <br>displayed 	| Pass    	|
| Add a new owner with<br> missing address field    	| 1e-1e1-1e2 	| [AddUser.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/features/AddUser.feature) 	| @Before<br>public void setUp(){}  	| none                	| ` firstName: Jack , lastName: Daniels, id: 15,<br> address:,city: Montreal,<br>telephone:5148970943`               	| owner is not added, <br>error message is<br>displayed  	| Pass    	|

#### Discussion of test failures
For `Feature 1: Add an owner`, the main scenario _Add a new owner_ failed. While debugging the step definition file, it showed that at the `@When("the user requests to add a new owner")`, the HTML response returns that some fields are empty, even if the fields are valid.  This bug is extremely severe as it prevents users from being able to add new owners to the application, which makes the software unreliable and unusable. However, if a user launches the PetClinic Application locally and attempts to create a new owner with valid fields, the new owner object is successfully created.Therefore, we can conclude that there was an error when implementing the `@When(“the user requests to add a new owner)`. In order to successfully pass all these scenarios, we must review our implementation and configuration of the RestTestTemplate.


#### Test Coverages
![image-acceptance1](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/wiki_images/Acceptance/AddUser-coverage.png)
As mentioned previously, our test coverage goals was to execute all the determined scenarios ( described above). As this picture demonstrates, we executed 6 scenarios ( same number as the scenarios developed from our scenario graph). 

### Feature 2: Add Visit 
#### Java Mapping
The gherkin steps for `Add Visit` can be found at [src/test/java/Acceptance/features/AddVisit.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/features/AddVisit.feature). The step definitions for “Add Visit” is located under [src/test/java/Acceptance/features/AddVisit.java](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/cucumber/stepdefs/AddVisit.java)
| Annotation 	| Function Name                                                                                              	| Goal                                                                                                                                                                                                                                                                                  	|
|------------	|------------------------------------------------------------------------------------------------------------	|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	|
| @Before    	| public void setup()                                                                                        	| initializes the global variables<br>which will store the added visits<br>throughout the steps                                                                                                                                                                                         	|
| @Given     	| public void <br>the_following_information_about_a_new_visit<br>(final Visit visit){}                       	| With the input, creates a Visit <br>object with the ObjectMapper.<br> This object is stored in global<br> variable _private Visit toAdd_. <br>the association is created between<br>the pet _petSelected_ and _toAdd_. <br>The visit object is added<br>to the List of ExpectedVisits 	|
| @And       	| public void<br> the_new_visit_has_the_date_field_specified_as_follows<br>(DataTable dataTable){}           	| With the input as the date for the <br>new visit, filters through<br>the data of the DataTable. <br>Checks if the date input string is<br>blank and is in the proper format<br>before setting adding it the List of <br>ExpectedVisits                                                	|
| @When      	| public void the_user_submits_the_add_visit_form() <br>throws JsonMappingException, JsonProcessingException 	| With the use of the global variables,<br>we can access the ownerId and petId <br>associated to _private Visit toAdd_.<br>With these variables, concatenate <br>the proper URI for the Post endpoint.<br>Sends a POST request to database<br>to create a new Visit object.             	|
| @Then      	| public void the_visit_should_be_added_to_the_database()                                                    	| Uses the _visitRepository's getByetId(id)_ <br>function to retrieve all the visits <br>for _petSelected_ and stores results<br>in local variable. Checks that <br>the retrieved visit list is equal to <br>the expected visit list                                                    	|
|   @Then         	| public void the_visit_should_not_be_added_to_the_database()                                                	| Since _toAdd_is invalid, the visit was not<br>added to the _expectedVisit_ list and<br>_actualVisit_ list. Therefore, check<br>if the size of both lists are the same,<br>and that their last element are the same.                                                                   	|
|   @Then         	| public void the_system_will_redisplay_the_form_page()                                                      	| If there is an error in the form, the form has <br>to be redisplayed. Check that the form on the <br>returned HTML document has labels with appropriate<br>titles                                                                                                                     	|
|        @Then    	| an_error_message_under_the_description_field_will_be_displayed()                                           	| Check if the error message appears<br>under the description field.                                                                                                                                                                                                                    	|

#### Helper Methods 
For the implementation of the visit function, some helper functions were defined at the end of the either [AddVisit.java](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/cucumber/stepdefs/AddVisit.java). In addition, a setter function was added in the Visit model [Visit.java](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/acceptance-testing/src/main/java/org/springframework/samples/petclinic/model/Visit.java). 
| function Name                                  	| src file                                                                                                                                                              	| Goal                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	|
|------------------------------------------------	|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------	|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	|
| private String createURLWithPort(String uri)   	| [AddVisit.java](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/acceptance-testing/src/test/java/Acceptance/cucumber/stepdefs/AddVisit.java)          	| concatenates the port used from<br>Spring BootTest.WebEnvironment.RANDOM_PORT<br>, localHost and the input uri.                                                                                                                                                                                                                                                                                                                                                                                                                                                                 	|
| private boolean isDateValidFormat(String date) 	| [AddVisit.java](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/acceptance-testing/src/test/java/Acceptance/cucumber/stepdefs/AddVisit.java)          	| Ensures that the date from the Gherkin<br>feature file follows the provided <br>format ( YYYY-mm-dd). If it doesn't,<br>return false, if it does, return true                                                                                                                                                                                                                                                                                                                                                                                                                   	|
| public boolean setStringDate(String date)      	| [Visit.java](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/acceptance-testing/src/main/java/org/springframework/samples/petclinic/model/Visit.java) 	| Initializes a dateFormatter following the<br>format ( YYYY-mm-dd), then parse the date<br>following the dateFormatter. If the<br>provided date is not in the correct format,<br>the method throws a DateTimeParseException.<br><br>This method was added, because when we tried <br>doing `DateTime d = DateTime.parse(date); <br>visit.setDate(d)` in the<br>step definition function, it<br>returned an error. Therefore, instead of throwing <br>an error, we decided that it would be better to <br>catch the error, and set the date of the visit<br>to be null or empty.  	|

#### Documentation for each scenario 
| Name                                                                         	| Events          	| Gherkin Scenario                                                                                                                              	| Setup                                                                                                	| Tear down         	| Inputs                                         	| Outputs                                                 	| Results 	|
|------------------------------------------------------------------------------	|-----------------	|-----------------------------------------------------------------------------------------------------------------------------------------------	|------------------------------------------------------------------------------------------------------	|-------------------	|------------------------------------------------	|---------------------------------------------------------	|---------	|
| Add Visit (Normal Flow)                                                      	| 1-2-3           	| [AddVisit.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/features/AddVisit.feature) 	| initializes the global  variables containing the  actual visits added and the expected visits added  	| clear both lists. 	| `description:neutered, petId: 1`  `2021-12-19` 	| initijava.lang.AssertionError: expected:<1> but was:<0> 	| Fail    	|
| Add Visit with missing date  (Alternative Flow)                              	| 1a-1a1-1a2      	| [AddVisit.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/features/AddVisit.feature) 	| initializes the global  variables containing the  actual visits added and the expected visits added  	| clear both  lists 	| `description: rabies, petId: 7`  `[blank]`     	| java.lang.AssertionError:  expected:<3> but was:<2>     	| Fail    	|
| Add Visit with missing description ( Alternative Flow)                       	| 1b-1b1-1b2      	| [AddVisit.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/features/AddVisit.feature) 	| intializes the global variables containing the actual visits added and the expected visits added     	| clear both  lists 	| `description: ,  petId: 7`  `2021-12-21`       	| Pass                                                    	| Pass    	|
| Add Visit with missing  description and missing date  ( Alternative Flow)    	| 1c-1c1 -1c2-1c3 	| [AddVisit.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/features/AddVisit.feature) 	| initializes the global variables containing the actual visits added and the expected visits added    	| clear both lists  	| `description:,  petId: 7`  `[blank]`           	| pass                                                    	| Pass    	|
| Add Visit with  wrong date format  (Alternative Flow)                        	| 1d-1d1- 1d2-1d3 	| [AddVisit.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/features/AddVisit.feature) 	| initializes the global variables containing the actual visits added and the expected visits added    	| clear both  lists 	| `description:rabies, petId:7`  `202111134`     	| Pass                                                    	| Pass    	|
| Add Visit with  missing description and wrong date format (Alternative Flow) 	| 1e-1e1 -1e2-1e3 	| [AddVisit.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/src/test/java/Acceptance/features/AddVisit.feature) 	| initializes the global  variables containing  the actual visits added and the expected visits  added 	| clear both lists  	| `description, petId:10`  `23 November 2021`    	| Pass                                                    	| Pass    	|

#### Discussion of test failures
For `Feature 2: Add Visit`, 4 out of 6 scenarios passed. The two scenarios `Add Visit(Normal Flow)`  and `And Visit with missing date ( Alternative Flow)` both failed, when they are expected to succeed. Through the debugger tool on eclipse, similarly to Feature 1, the TestRestTemplate.postForEntity remains on the same page and displays error messages that the provided fields are empty. This bug is is severe as it prevents users from being able to create new visits for pets. Additionally, this bug reduces the software usability and reveals that the Application does not meet the expected requirements. . However, if a user launches the PetClinic Application locally and attempts to create a new visit for an existing animal with valid fields and/or empty date field, the new owner object is successfully created.Therefore, we can conclude that there was an error when implementing the `@When(“the user requests to add a new owner)`. In order to successfully pass all these scenarios, we must review our implementation and configuration of the RestTestTemplate.

#### Test Coverage Goals
![image2-a2](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/wiki_images/Acceptance/AddVisit-coverage.png)
As mentioned previously, our test coverage goals was to execute all the determined scenarios ( described above). As this picture demonstrates, we executed 6 scenarios ( same number as the scenarios developed from our scenario graph). 

### Feature 3: Find owners by the last name
#### Java Mappings
The feature file for " Find owners by the last name " is located under [src/test/java/Acceptance/features/FindOwners.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/acceptance-testing/src/test/java/Acceptance/features/FindOwners.feature)
The step definitions for " Find owners by the last name "  is located under [src/test/java/Acceptance/cucumber/stepdefs/AddUser.java](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/acceptance-testing/src/test/java/Acceptance/cucumber/stepdefs/FindOwners.java) 
* `@Before public void setUp(){}`: This occurs at the beginning of each scenario. Since we will store the data from the database in the variables  _private List<Owner> expectedOwners;_ , _private List<Owner> actualOwners_, _private List<Owner> tmpList_, _private String allOwners_, _private String restOfOwners_, _private String error_; we must intiailize them as empty objects. Then, by using TestRestTemplate and private methods for parsing html, we will populate the _ expectedOwners_ and _actualOwners_ list with the already existing owners of the PetClinic Application. The remaining variables are used in the private methods.
* `@Given("the following information for an owner")`: With all the necessary attributes provided as the input, the CucumberConfiguration transformer method will be able to create an owner object. The create owner object will be stored in the owner repository (previously declared as an object) and added to the _List<Owner> actualOwner_.
* `@When("User searches an owners with specified {string}")`: Occurs when the user has finished inputing in the text field on the page to find owners. This function will call the GET operation that will return a list of all owners matching with the input. More specifically, it will call the helper method `htmlToList()`, which will parse the html text received from the call and will add owners to the global variable _List<Owner> actualOwner_ (this function is explained more in details in the Helper Method section).
* `@Then("the following owner information shall be displayed:")`: This method parses the result received from the GET request and stores the arguments passed on from the feature file into _List<Owner> tmpList_, once again by using `htmlToList()`. It will then compare each attributes of the owner in the _List<Owner> actualOwner_ and the feature file argument using assertions.
* `@Then("the following owners shall be displayed in the list:")`: This method parses the result received from the GET request and stores the arguments passed on from the feature file into _List<Owner> tmpList_, once again by using `htmlToList()`. It will then compare each attributes of the owners in the _List<Owner> actualOwner_ and the feature file arguments using assertions.
* `@Then("the system shall raise the error {string}")`: Occurs when and error is raised when searching for a owners, which will happen most likely due to the owner repository containing no owner matching with the input specified in the feature file. It will check if the error returned by the GET request is equal to the expected error that should be raised in case of unexistent owner using assertions.

#### Helper Methods
`htmlToList()`: Takes as input the string in html form containing the owner list and a boolean. It is true if we want to store owners in the list returned by the GET request and false if it is to store the input owners in the feature files. This method will in turn call `htmlToOwner()` in a loop so that it continues parsing all the owners and storing them in the dedicated global lists. The method returns a string, which is the continuation of the html file that is still unparsed. This string will be used for future parsing.
` htmlToOwner()`: Takes as input an array of string containing the string to parse and a string for indication purposes. This method will extract the owners information and will create new owners to add into the global lists. It will return another array of string containing the rest of the string to parse and another indicator string.
` nameExists`: Takes as input a list of owners and a string representing a first name, and checks if the list contains any owner with such first name. Returns true if so, false otherwise.


#### Documentation for each scenario:
| Name                                              	| Events     	| Gherklin <br>Scenario <br>File                                                                                                                          	| Set up steps                      	| Tear down <br>Steps 	| Inputs                                                                                                             	| Outputs                                                	| Results 	|
|---------------------------------------------------	|------------	|---------------------------------------------------------------------------------------------------------------------------------------------------------	|-----------------------------------	|---------------------	|--------------------------------------------------------------------------------------------------------------------	|--------------------------------------------------------	|---------	|
| Find an existing owner                                   	| 1-2-3-4      	| [FindOwners.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/acceptance-testing/src/test/java/Acceptance/features/FindOwners.feature) 	| @Before <br>public void setUp(){} 	| none                	| `lastName: Black` 	|  `firstName: Jeff, lastName: Black, address: 1450 Oak Blvd., city: Monona, telephone: 6085555387`                               	| Pass    	|
| Find existing owners	| 1-2-3b-3b1 	| [FindOwners.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/acceptance-testing/src/test/java/Acceptance/features/FindOwners.feature) 	| @Before <br>public void setUp(){} 	| none                	| `lastName: Davis`    	| `firstName:Betty, lastName:Davis, address:638 Cardinal Ave., city:Sun Prairie, telephone:6085551749;	 firstName:Harold, lastName:Davis, address:563 Friendly St., city:Windsor, telephone:6085553198`| Fail   	|
| Find all owners	| 1a-1a1-2-3	| [FindOwners.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/acceptance-testing/src/test/java/Acceptance/features/FindOwners.feature) 	| @Before <br>public void setUp(){} 	| none                	| none|	`firstName:George, lastName:Franklin, address:110 W. Liberty St., city:Madison, telephone:6085551023; firstName:Betty, lastName:Davis, address:638 Cardinal Ave., city:Sun Prairie, telephone:6085551749; firstName:Eduardo, lastName:Rodriquez, address:2693 Commerce St., city:McFarland, telephone:6085558763; firstName:Harold, lastName:Davis, address:563 Friendly St., city:Windsor, telephone:6085553198; firstName:Peter, lastName:McTavish, address:2387 S. Fair Way, city:Madison, telephone:6085552765; firstName:Jean, lastName:Coleman, address:105 N. Lake St., city:Monona, telephone:6085552654; firstName:Jeff, lastName:Black, address:1450 Oak Blvd., city:Monona, telephone:6085555387; firstName:Maria, lastName:Escobito, address:345 Maple St., city:Madison, telephone:6085557683; firstName:David, lastName:Schroeder, address:2749 Blackhawk Trail, city:Madison, telephone:6085559435; firstName:Carlos, lastName:Estaban, address:2335 Independence La., city:Waunakee, telephone:6085555487 `| Fail    	|
| Find non-existing owners    	| 1-2-3a-3a1 	| [FindOwners.feature](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/acceptance-testing/src/test/java/Acceptance/features/FindOwners.feature) 	| @Before<br>public void setUp(){}  	| none                	| ` lastName: Smith`               	| owner does not exist, error message is displayed  	| Pass    	|

#### Discussion of test failures
Out of the fours scenarios, two of them have passed while two have failed. The `@Given("the following information for an owner")` step definition passed, allowing the two scenarios to pass. The failure of the other two functions is caused by the errors present in the private helper functions used to parse the html file from the GET request. In order to successfully pass all scenarios, we would have to revise the helper functions more thoroughly. On another point, another way to parse html is by using the Jsoup parser tool, which would highly optimize the time used to write the tests and reduce the chances of producing code errors.

The failure that has occurred during testing does not greatly impact the functionality of the application. However, they would be crucial for the user experience. In the case of searching for owners sharing the same last name, such failure would prevent the user from searching the for those owners through the find page. If the user wants to find such owners, they would have to go through the entire list of all owners to find the specific owner, which would make the navigation of the webpage really unpleasant. Another way is to input the id of the owner, if they know it, in the address bar of the webpage. However, this method does not go through the user interface, which could be missed by most users. In the case of failing to return the list of all owners through the find page, the owner would not be able to access the list of all users by using the user interface. The other way is to input the address leading to the list of all owners in the address bar, which is not within the scope of knowledge of every user. Both of these cases would not impact the backend functionality of the application. However, they would greatly decrease the user experience of the application, as some users would not be able to use the user interface as its full functionality, thus discouraging people to use the application and the booking service as a whole.

#### Test Coverage Goals

The " Find owners by the last name " acceptance test covers and tests the function `public String processFindForm()` in the OwnerController. By extension, it also covers the methods `findByLastName()` and `save()` in the OwnerRepository, as well as multiple methods in the model classes of Owner.  Pairing this test with the unit tests and API tests on the Owner class will ensure the entire find page functionality of the appplication.

Since there are 4 scenarios in the feature files and there are 4 scenarios in the scenario graphs (onw main path and 3 alternatives), our testing covered the goal we want to meet.
![](https://github.com/McGill-ECSE429-Fall2021/project-test-14/blob/master/wiki_images/Acceptance/filterOwner-coverage.png)
